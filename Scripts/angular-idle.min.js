/*** Directives and services for responding to idle users in AngularJS
* @author Mike Grabski <me@mikegrabski.com>
* @version v1.1.0
* @link https://github.com/HackedByChinese/ng-idle.git
* @license MIT
*/
(function(n,t){"use strict";t.module("ngIdle",["ngIdle.keepalive","ngIdle.idle"]);t.module("ngIdle.keepalive",[]).provider("Keepalive",function(){var n={http:null,interval:600},i;this.http=function(i){if(!i)throw new Error("Argument must be a string containing a URL, or an object containing the HTTP request configuration.");t.isString(i)&&(i={url:i,method:"GET"});i.cache=!1;n.http=i};i=this.interval=function(t){if(t=parseInt(t),isNaN(t)||t<=0)throw new Error("Interval must be expressed in seconds and be greater than 0.");n.interval=t};this.$get=["$rootScope","$log","$interval","$http",function(r,u,f,e){function s(n,t){r.$broadcast("KeepaliveResponse",n,t)}function h(){r.$broadcast("Keepalive");t.isObject(n.http)&&e(n.http).success(s).error(s)}var o={ping:null};return{_options:function(){return n},setInterval:i,start:function(){return f.cancel(o.ping),o.ping=f(h,n.interval*1e3),o.ping},stop:function(){f.cancel(o.ping)},ping:function(){h()}}}]});t.module("ngIdle.idle",["ngIdle.keepalive","ngIdle.localStorage"]).provider("Idle",function(){var n={idle:1200,timeout:30,autoResume:"idle",interrupt:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll",keepalive:!0,titleDisabled:!1},u=this.timeout=function(i){if(i===!1)n.timeout=0;else if(t.isNumber(i)&&i>=0)n.timeout=i;else throw new Error("Timeout must be zero or false to disable the feature, or a positive integer (in seconds) to enable it.");},i,r;this.interrupt=function(t){n.interrupt=t};i=this.idle=function(t){if(t<=0)throw new Error("Idle must be a value in seconds, greater than 0.");n.idle=t};r=this.titleDisabled=function(t){n.titleDisabled=t===!0};this.autoResume=function(t){n.autoResume=t===!0?"idle":t===!1?"off":t};this.keepalive=function(t){n.keepalive=t===!0};this.$get=["$interval","$log","$rootScope","$document","Keepalive","IdleLocalStorage","$window",function(f,e,o,s,h,c,l){function k(){n.keepalive&&(a.running&&h.ping(),h.start())}function v(){n.keepalive&&h.stop()}function d(){a.idling=!a.idling;var t=a.idling?"Start":"End";o.$broadcast("Idle"+t);a.idling?(v(),n.timeout&&(a.countdown=n.timeout,g(),a.timeout=f(g,1e3,n.timeout,!1))):k();f.cancel(a.idle)}function g(){if(a.countdown<=0){nt();return}o.$broadcast("IdleWarn",a.countdown);a.countdown--}function nt(){v();f.cancel(a.idle);f.cancel(a.timeout);a.idling=!0;a.running=!1;a.countdown=0;o.$broadcast("IdleTimeout")}function y(n,t,i){var r=n.running();n.unwatch();t(i);r&&n.watch()}function it(){var n=c.get("expiry");return n&&n.time?new Date(n.time):null}function tt(n){n?c.set("expiry",{id:b,time:n}):c.remove("expiry")}var a={idle:null,timeout:null,idling:!1,running:!1,countdown:null},b=(new Date).getTime(),p={_options:function(){return n},_getNow:function(){return new Date},getIdle:function(){return n.idle},getTimeout:function(){return n.timeout},setIdle:function(n){y(this,i,n)},setTitleDisabled:function(n){y(this,r,n)},isTitleDisabled:function(){return n.titleDisabled},setTimeout:function(n){y(this,u,n)},isExpired:function(){var n=it();return n!==null&&n<=this._getNow()},running:function(){return a.running},idling:function(){return a.idling},watch:function(t){f.cancel(a.idle);f.cancel(a.timeout);var i=n.timeout?n.timeout:0;t||tt(new Date((new Date).getTime()+(n.idle+i)*1e3));a.idling?d():a.running||k();a.running=!0;a.idle=f(d,n.idle*1e3,0,!1)},unwatch:function(){f.cancel(a.idle);f.cancel(a.timeout);a.idling=!1;a.running=!1;tt(null);v()},interrupt:function(t){if(a.running){if(n.timeout&&this.isExpired()){nt();return}n.autoResume!=="idle"&&(n.autoResume!=="notIdle"||a.idling)||this.watch(t)}}},w;s.find("body").on(n.interrupt,function(n){(n.type!=="mousemove"||n.originalEvent.movementX!==0||n.originalEvent.movementY!==0)&&p.interrupt()});return w=function(n){if(n.key==="ngIdle.expiry"&&n.newValue!==n.oldValue){var i=t.fromJson(n.newValue);if(i.id===b)return;p.interrupt(!0)}},l.addEventListener?l.addEventListener("storage",w,!1):l.attachEvent("onstorage",w),p}]});t.module("ngIdle.countdown",["ngIdle.idle"]).directive("idleCountdown",["Idle",function(n){return{restrict:"A",scope:{value:"=idleCountdown"},link:function(t){t.value=n.getTimeout();t.$on("IdleWarn",function(n,i){t.$evalAsync(function(){t.value=i})});t.$on("IdleTimeout",function(){t.$evalAsync(function(){t.value=0})})}}}]);t.module("ngIdle.title",[]).factory("Title",["$document","$interpolate",function(n,i){function u(n,t,i){return new Array(t-String(n).length+1).join(i||"0")+n}var r={original:null,idle:"{{minutes}}:{{seconds}} until your session times out!",timedout:"Your session has expired."};return{original:function(n){if(t.isUndefined(n))return r.original;r.original=n},store:function(n){(n||!r.original)&&(r.original=this.value())},value:function(i){if(t.isUndefined(i))return n[0].title;n[0].title=i},idleMessage:function(n){if(t.isUndefined(n))return r.idle;r.idle=n},timedOutMessage:function(n){if(t.isUndefined(n))return r.timedout;r.timedout=n},setAsIdle:function(n){this.store();var t={totalSeconds:n};t.minutes=Math.floor(n/60);t.seconds=u(n-t.minutes*60,2);this.value(i(this.idleMessage())(t))},setAsTimedOut:function(){this.store();this.value(this.timedOutMessage())},restore:function(){this.original()&&this.value(this.original())}}}]).directive("title",["Idle","Title",function(n,t){return{restrict:"E",link:function(i,r,u){n.isTitleDisabled()||u.idleDisabled||(t.store(!0),i.$on("IdleStart",function(){t.original(r[0].innerText)}),i.$on("IdleWarn",function(n,i){t.setAsIdle(i)}),i.$on("IdleEnd",function(){t.restore()}),i.$on("IdleTimeout",function(){t.setAsTimedOut()}))}}}]);t.module("ngIdle.localStorage",[]).service("IdleLocalStorage",["$window",function(n){var i=n.localStorage;return{set:function(n,r){i.setItem("ngIdle."+n,t.toJson(r))},get:function(n){return t.fromJson(i.getItem("ngIdle."+n))},remove:function(n){i.removeItem("ngIdle."+n)}}}])})(window,window.angular);
//# sourceMappingURL=angular-idle.min.js.map
